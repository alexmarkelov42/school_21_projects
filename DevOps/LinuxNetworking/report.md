
# Table of Contents

1.  [Linux](#org21e77ca)
    1.  [Часть 1. ipcalc tool](#org9946be1)
        1.  [1.1 Сети и маски](#orgddd8ee3)
        2.  [1.2 localhost](#org5dd1fc1)
        3.  [1.3 Диапазоны и сегменты сетей](#orgb2f30bc)
    2.  [Часть 2. Статическая маршрутизация между двумя машинами](#org82e86e3)
        1.  [2.1 Добавление статического маршрута вручную](#org62ce5c9)
        2.  [2.2 Добавление статического маршрута с сохранением](#orgb1c506a)
    3.  [Часть 3. Утилита iperf3](#org49cb103)
        1.  [3.1  Скорость соединения](#org67857f1)
        2.  [3.2 Утилита iperf3](#orgf3b94e8)
    4.  [Часть 4. Сетевой экран](#orgc87bcca)
        1.  [4.1. Утилита iptables](#orgffb557a)
        2.  [4.2. Утилита nmap](#org10e792c)
    5.  [Часть 5 Статическая маршрутизация сети](#org679d236)
        1.  [5.1 Настройка адресов машин](#orgad23d70)
        2.  [5.2 Включение переадресации IP-адресов](#orgeda8589)
        3.  [5.3 Установка маршрута по умолчанию](#org0d1cc6f)
        4.  [5.4 Добавление статических маршрутов](#orge5e94cf)
        5.  [5.5 Построение списка маршрутизаторов](#org8c9e1bd)
        6.  [5.6 Использование протокола ICMP при маршрутизации](#orgee42c2c)
    6.  [Часть 6. Динамическая настройка IP с помощью DHCP](#org01235a1)
    7.  [Часть 7. NAT](#org5c562c4)


<a id="org21e77ca"></a>

# Linux


<a id="org9946be1"></a>

## Часть 1. ipcalc tool


<a id="orgddd8ee3"></a>

### 1.1 Сети и маски

1.  ![img](images/1_1.png)
    
    Адрес сети

2.  255.255.255.0:
    
    -   24 в префиксной записи
    -   11111111.11111111.11111111.0 в двоичной записи
    
    11111111.11111111.11111111.11110000:
    
    -   255.255.255.240 в обычной записи
    -   28 в префиксной записи

3.  Минимальный и максимальный хост в сети 12.167.38.4 при масках:
    1.  /8.
        ![img](images/1_1_2.png)
    
    2.  11111111.11111111.00000000.00000000
        ![img](images/1_1_3.png)
    
    3.  255.255.254.0
        ![img](images/1_1_4.png)
    
    4.  /4
        ![img](images/1_1_5.png)


<a id="org5dd1fc1"></a>

### 1.2 localhost

Можно ли обратиться к приложению, работающему на localhost, со следующими IP:

-   194.34.23.100 - нельзя
-   127.0.0.2 - можно
-   127.1.0.1 - можно
-   128.0.0.1 - нельзя


<a id="orgb2f30bc"></a>

### 1.3 Диапазоны и сегменты сетей

1.  Какие из перечисленных IP можно использовать в качестве публичного, а какие только в качестве частных:
    -   10.0.0.45 - частная
    -   134.43.0.2 - публичная
    -   192.168.4.2 - частная
    -   172.20.250.4 - частная
    -   172.0.2.1 - публичная
    -   192.172.0.1 - публичная
    -   172.68.0.2 - публичная
    -   172.16.255.255 - частная
    -   10.10.10.10 - частная
    -   192.169.168.1 - публичная
2.  Какие из перечисленных IP адресов шлюза возможны у сети 10.10.0.0/18:
    -   10.0.0.1 - возможно
    -   10.10.0.2 - возможно
    -   10.10.10.10 - возможно
    -   10.10.100.1 - невозможно
    -   10.10.1.255 - возможно


<a id="org82e86e3"></a>

## Часть 2. Статическая маршрутизация между двумя машинами

![img](images/2_1_1.png)

сетевые интерфейсы ws1

![img](images/2_1_2.png)

сетевые интерфейсы ws2

![img](images/2_1_3.png)

config.yaml для ws1

![img](images/2_1_4.png)

config.yaml для ws2


<a id="org62ce5c9"></a>

### 2.1 Добавление статического маршрута вручную

![img](images/2_1_5.png)

Соединение от ws1 к ws2 по статическому ip-адресу

![img](images/2_1_6.png)

Соединение от ws2 к ws1 по статическому ip-адресу


<a id="orgb1c506a"></a>

### 2.2 Добавление статического маршрута с сохранением

![img](images/2_2_1.png)

Соединение от ws1 к ws2 по статическому ip-адресу

![img](images/2_2_2.png)

Соединение от ws2 к ws1 по статическому ip-адресу


<a id="org49cb103"></a>

## Часть 3. Утилита iperf3


<a id="org67857f1"></a>

### 3.1  Скорость соединения

-   8 Mbps = 1 MBs
-   100 MB/s = 800000 kbps
-   1 Gbps =  1000 Mbps


<a id="orgf3b94e8"></a>

### 3.2 Утилита iperf3

![img](images/2_3_1.png)

iperf3 сервер на ws2

![img](images/2_3_2.png)

Скорость соединения ws1 с ws2


<a id="orgc87bcca"></a>

## Часть 4. Сетевой экран


<a id="orgffb557a"></a>

### 4.1. Утилита iptables

![img](images/4_1_1.png)

filewall.sh на ws1

![img](images/4_1_2.png)

filewall.sh на ws2

![img](images/4_1_3.png)

Запуск скрипта на ws1

![img](images/4_1_4.png)

Запуск скрипта на ws2

Пинг с ws1 на ws2 виден, но не разрешён. Пинг с ws2 на ws1 отсутствует.


<a id="org10e792c"></a>

### 4.2. Утилита nmap

![img](images/4_1_5.png)

ping ws2 с ws1

![img](images/4_1_6.png)

ping ws1 с ws2

![img](images/4_2_1.png)

nmap запущенный на ws2

![img](images/4_2_2.png)

nmap запущенный на ws1


<a id="org679d236"></a>

## Часть 5 Статическая маршрутизация сети


<a id="orgad23d70"></a>

### 5.1 Настройка адресов машин

![img](images/5_1_1.png)

00-installer-config.yaml на ws11

![img](images/5_1_2.png)

00-installer-config.yaml на r1

![img](images/5_1_3.png)

00-installer-config.yaml на ws21

![img](images/5_1_4.png)

00-installer-config.yaml на ws22

![img](images/5_1_5.png)

00-installer-config.yaml на r2

![img](images/5_1_6.png)

Сетевые интерфейсы ws11

![img](images/5_1_7.png)

Сетевые интерфейсы r1

![img](images/5_1_8.png)

Сетевые интерфейсы ws21

![img](images/5_1_9.png)

Сетевые интерфейсы ws22

![img](images/5_1_10.png)

Сетевые интерфейсы r2

![img](images/5_1_11.png)

ping с ws21 до ws22

![img](images/5_1_12.png)

ping с ws11 до r1


<a id="orgeda8589"></a>

### 5.2 Включение переадресации IP-адресов

![img](images/5_2_1.png)

Включение переадресации IP-адресов на r1

![img](images/5_2_2.png)

Включение переадресации IP-адресов на r2

![img](images/5_2_3.png)

Включение переадресации IP-адресов с помощью /etc/sysctl.conf на r1

![img](images/5_2_4.png)

Включение переадресации IP-адресов с помощью /etc/sysctl.conf на r2


<a id="org0d1cc6f"></a>

### 5.3 Установка маршрута по умолчанию

![img](images/5_3_1.png)

Конфигурация r1

![img](images/5_3_2.png)

Таблица маршрутизации r1

![img](images/5_3_3.png)

Вывод команды tcpdump на r2


<a id="orge5e94cf"></a>

### 5.4 Добавление статических маршрутов

![img](images/5_4_1.png)

Конфигурационный файл для r1

![img](images/5_4_2.png)

Вывод команды ip r для r1

![img](images/5_4_3.png)

Конфигурационный файл для r2

![img](images/5_4_4.png)

Вывод команды ip r для r2

![img](images/5_4_5.png)

Вывод команды ip r list 10.10.0.0/18 для ws11

![img](images/5_4_6.png)

Вывод команды ip r list 0.0.0.0/0 для ws11

Маршруты команд различаются, потому что 0.0.0.0/0 - это статический маршрут по умолчанию


<a id="org8c9e1bd"></a>

### 5.5 Построение списка маршрутизаторов

![img](images/5_5_1.png)

Вывод команды tracepath на ws11

![img](images/5_5_2.png)

Вывод команды tcpdump -tnv -i enp0s8 на r1


<a id="orgee42c2c"></a>

### 5.6 Использование протокола ICMP при маршрутизации

![img](images/5_6_1.png)

Вывод команды ping -c 3 10.30.0.111 на ws1

![img](images/5_6_2.png)

Вывод команды tcpdump -tnv -i enp0s8 на r1


<a id="org01235a1"></a>

## Часть 6. Динамическая настройка IP с помощью DHCP

![img](images/6_1_1.png)

Конфигурация файла /etc/dhcp/dhcpd.conf на r2

![img](images/6_1_2.png)

Конфигурация файла /etc/resolf.conf на r2

![img](images/6_1_3.png)

Запуск dhcp процесса на r2

![img](images/6_1_4.png)

IP адрес ws21

![img](images/6_1_5.png)

ping ws22 с ws21

![img](images/6_1_6.png)

00-installer-config.yaml для ws11 с указанием mac адреса

![img](images/6_1_7.png)

00-installer-config.yaml для r1

![img](images/6_1_8.png)

ip адрес ws11 до обновления

![img](images/6_1_9.png)

обновление ip адреса на ws11


<a id="org5c562c4"></a>

## Часть 7. NAT

![img](images/7_1_1.png)

Настройка общедоступности apache для ws22

![img](images/7_1_2.png)

Настройка общедоступности apache для r1

![img](images/7_1_3.png)

Запуск apache2 на ws22

![img](images/7_1_4.png)

Запуск apache2 на r1

![img](images/7_1_5.png)

запуск firewall на r2

![img](images/7_1_6.png)

ping ws22 с r1

![img](images/7_1_7.png)

Разрешение маршрутизации ICMP на r2

![img](images/7_1_8.png)

ping ws22 с r1

![img](images/7_1_9.png)

Добавление SNAT и DNAT на r2

![img](images/7_1_10.png)

подключение с помощью telnet с ws22 к r1

![img](images/7_1_11.png)

подключение с помощью telnet с r1 к ws22

